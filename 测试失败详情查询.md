# æµ‹è¯•å¤±è´¥ç”¨ä¾‹è¯¦æƒ…æŸ¥è¯¢

## ğŸ” é—®é¢˜è¯Šæ–­

æ‚¨åé¦ˆå¯¼å‡ºçš„æŠ¥å‘Šä¸­çœ‹ä¸åˆ°å¤±è´¥ç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŸå› ã€é”™è¯¯æ¶ˆæ¯ç­‰ï¼‰ã€‚

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. **ä¿®æ”¹SQLæŸ¥è¯¢** (`ReportMapper.xml`)
- âœ… ç§»é™¤äº†`<if test="includeFailureDetails == true">`æ¡ä»¶
- âœ… **ç°åœ¨å§‹ç»ˆæŸ¥è¯¢å¤±è´¥è¯¦æƒ…å­—æ®µ**ï¼š
  - `failure_message` - é”™è¯¯æ¶ˆæ¯
  - `failure_trace` - å †æ ˆè·Ÿè¸ª
  - `failure_type` - é”™è¯¯ç±»å‹
- âœ… æ·»åŠ äº†å­—æ®µåˆ«åæ˜ å°„ï¼ˆé©¼å³°å‘½åï¼‰
- âœ… ä¿®å¤äº†JOINæ¡ä»¶ï¼ˆæ·»åŠ `task_type = 'test_case'`ï¼‰

### 2. **æ·»åŠ è°ƒè¯•æ—¥å¿—** (`ReportExportServiceImpl.java`)
æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ï¼š
- æ€»æµ‹è¯•ç»“æœæ•°
- å¤±è´¥/å¼‚å¸¸ç”¨ä¾‹æ•°
- åŒ…å«å¤±è´¥ä¿¡æ¯çš„ç”¨ä¾‹æ•°
- ç¬¬ä¸€ä¸ªå¤±è´¥ç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. é‡å¯åº”ç”¨
```bash
mvn spring-boot:run
```

### 2. å¯¼å‡ºæŠ¥å‘Šï¼ˆå¸¦å¤±è´¥è¯¦æƒ…ï¼‰
```bash
curl "http://localhost:8080/api/reports/3/export?export_format=html&include_details=true&include_failure_details=true" -o report.html
```

### 3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
=== æŠ¥å‘Šå¯¼å‡ºè°ƒè¯•ä¿¡æ¯ ===
æ€»æµ‹è¯•ç»“æœæ•°: 10
å¤±è´¥/å¼‚å¸¸ç”¨ä¾‹æ•°: 3
åŒ…å«å¤±è´¥ä¿¡æ¯çš„ç”¨ä¾‹æ•°: 3
includeFailureDetails: true
ç¬¬ä¸€ä¸ªå¤±è´¥ç”¨ä¾‹:
  - ç”¨ä¾‹åç§°: ç™»å½•æ¥å£æµ‹è¯•
  - å¤±è´¥æ¶ˆæ¯: é¢„æœŸçŠ¶æ€ç ä¸º200ï¼Œå®é™…ä¸º500
  - å¤±è´¥ç±»å‹: AssertionError
  - å †æ ˆè·Ÿè¸ªé•¿åº¦: 1234
=======================
```

### 4. æ‰“å¼€HTMLæ–‡ä»¶
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€`report.html`ï¼Œæ£€æŸ¥ï¼š
- âŒ å¤±è´¥ç”¨ä¾‹è¯¦æƒ…éƒ¨åˆ†æ˜¯å¦æ˜¾ç¤º
- ğŸ” é”™è¯¯è¯¦æƒ…æ¡†æ˜¯å¦åŒ…å«ï¼š
  - é”™è¯¯ç±»å‹ï¼ˆçº¢è‰²å¾½ç« ï¼‰
  - é”™è¯¯æ¶ˆæ¯
  - å †æ ˆè·Ÿè¸ªï¼ˆä»£ç é£æ ¼ï¼‰

## ğŸ“Š æ•°æ®åº“æ£€æŸ¥

å¦‚æœä»ç„¶æ²¡æœ‰å¤±è´¥è¯¦æƒ…ï¼Œéœ€è¦æ£€æŸ¥æ•°æ®åº“ï¼š

```sql
-- æ£€æŸ¥TestCaseResultsè¡¨ä¸­æ˜¯å¦æœ‰å¤±è´¥è¯¦æƒ…æ•°æ®
SELECT 
    result_id,
    ref_id,
    status,
    failure_message,
    failure_trace,
    failure_type
FROM TestCaseResults
WHERE report_id = 3 
  AND status IN ('failed', 'broken')
  AND is_deleted = 0;
```

**å¯èƒ½çš„æƒ…å†µï¼š**

1. **æ•°æ®åº“ä¸­æ²¡æœ‰å¤±è´¥è¯¦æƒ…**
   - éœ€è¦åœ¨æµ‹è¯•æ‰§è¡Œæ—¶è®°å½•å¤±è´¥ä¿¡æ¯
   - æ£€æŸ¥æµ‹è¯•æ‰§è¡Œé€»è¾‘æ˜¯å¦ä¿å­˜äº†`failure_message`ç­‰å­—æ®µ

2. **å­—æ®µä¸ºNULL**
   - æµ‹è¯•æ¡†æ¶æ²¡æœ‰æ•è·å¼‚å¸¸ä¿¡æ¯
   - éœ€è¦åœ¨æµ‹è¯•æ‰§è¡Œæ—¶æ·»åŠ å¼‚å¸¸æ•è·é€»è¾‘

## ğŸ”§ å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰å¤±è´¥è¯¦æƒ…

éœ€è¦ä¿®æ”¹æµ‹è¯•æ‰§è¡Œé€»è¾‘ï¼Œåœ¨ç”¨ä¾‹å¤±è´¥æ—¶è®°å½•è¯¦ç»†ä¿¡æ¯ï¼š

```java
// ä¼ªä»£ç ç¤ºä¾‹
try {
    // æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
    executeTestCase(testCase);
    result.setStatus("passed");
} catch (AssertionError e) {
    result.setStatus("failed");
    result.setFailureType(e.getClass().getSimpleName());
    result.setFailureMessage(e.getMessage());
    result.setFailureTrace(getStackTrace(e));
} catch (Exception e) {
    result.setStatus("broken");
    result.setFailureType(e.getClass().getSimpleName());
    result.setFailureMessage(e.getMessage());
    result.setFailureTrace(getStackTrace(e));
}
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `src/main/resources/mapper/ReportMapper.xml`
   - ä¿®æ”¹`selectReportTestResults`æŸ¥è¯¢
   - å§‹ç»ˆæŸ¥è¯¢å¤±è´¥è¯¦æƒ…å­—æ®µ
   - æ·»åŠ å­—æ®µåˆ«å

2. âœ… `src/main/java/com/victor/iatms/service/impl/ReportExportServiceImpl.java`
   - æ·»åŠ è°ƒè¯•æ—¥å¿—
   - è¾“å‡ºå¤±è´¥ç”¨ä¾‹ç»Ÿè®¡ä¿¡æ¯

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é‡å¯åº”ç”¨å¹¶æµ‹è¯•**
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
   - ç¡®è®¤å¤±è´¥è¯¦æƒ…æ˜¯å¦è¢«æŸ¥è¯¢

2. **å¦‚æœæ—¥å¿—æ˜¾ç¤º"åŒ…å«å¤±è´¥ä¿¡æ¯çš„ç”¨ä¾‹æ•°: 0"**
   - è¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰å¤±è´¥è¯¦æƒ…æ•°æ®
   - éœ€è¦æ£€æŸ¥æµ‹è¯•æ‰§è¡Œé€»è¾‘

3. **å¦‚æœæ—¥å¿—æ˜¾ç¤ºæœ‰å¤±è´¥ä¿¡æ¯ï¼Œä½†HTMLä¸­çœ‹ä¸åˆ°**
   - å¯èƒ½æ˜¯HTMLæ¨¡æ¿é—®é¢˜
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯

4. **å¦‚æœä¸€åˆ‡æ­£å¸¸**
   - åˆ é™¤è°ƒè¯•æ—¥å¿—ï¼ˆSystem.out.printlnï¼‰
   - æäº¤ä»£ç 

---

**ä¿®æ”¹æ—¶é—´**: 2024-10-26  
**çŠ¶æ€**: âœ… å®Œæˆï¼Œå¾…æµ‹è¯•

