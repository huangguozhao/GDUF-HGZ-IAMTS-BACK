# 测试用例导入功能测试说明

## 测试环境准备

1. **启动应用**: 确保Spring Boot应用正常运行
2. **数据库准备**: 确保数据库中有测试用的接口数据
3. **用户登录**: 获取有效的JWT Token

## 测试用例

### 1. 正常导入测试

#### 测试步骤
1. 准备一个包含有效测试用例数据的Excel或CSV文件
2. 使用Postman或其他工具发送POST请求到 `/apis/{api_id}/test-cases/import`
3. 设置请求头: `Authorization: Bearer {token}`
4. 设置Content-Type为 `multipart/form-data`
5. 添加文件参数 `file`
6. 发送请求

#### 预期结果
- HTTP状态码: 200
- 响应code: 1
- 返回详细的导入统计信息

### 2. 文件格式验证测试

#### 测试用例1: 不支持的文件格式
- 上传 `.txt` 文件
- 预期结果: HTTP 400, code: -3, msg: "不支持的文件格式"

#### 测试用例2: 文件过大
- 上传超过10MB的文件
- 预期结果: HTTP 400, code: -3, msg: "文件大小超过限制"

#### 测试用例3: 空文件
- 上传空文件
- 预期结果: HTTP 400, code: -3, msg: "上传的文件为空"

### 3. 权限验证测试

#### 测试用例1: 未提供Token
- 不设置Authorization头
- 预期结果: HTTP 401, code: -1

#### 测试用例2: 无效Token
- 设置无效的Token
- 预期结果: HTTP 401, code: -1

#### 测试用例3: 权限不足
- 使用没有 `testcase:create` 权限的用户Token
- 预期结果: HTTP 403, code: -2

### 4. 接口验证测试

#### 测试用例1: 接口不存在
- 使用不存在的api_id
- 预期结果: HTTP 404, code: -4, msg: "接口不存在"

#### 测试用例2: 接口状态非active
- 使用状态为inactive的接口ID
- 预期结果: HTTP 404, code: -4, msg: "接口不存在"

### 5. 数据验证测试

#### 测试用例1: 缺少必填字段
- 上传缺少 `case_code` 或 `name` 的数据
- 预期结果: 在failed_records中显示相应错误

#### 测试用例2: 无效的优先级
- 上传优先级为无效值的数据
- 预期结果: 在failed_records中显示"优先级值无效"

#### 测试用例3: 无效的严重程度
- 上传严重程度为无效值的数据
- 预期结果: 在failed_records中显示"严重程度值无效"

### 6. 冲突处理测试

#### 测试用例1: 用例编码冲突 - skip策略
- 上传包含已存在用例编码的数据，使用skip策略
- 预期结果: 冲突的用例被跳过，skip_count增加

#### 测试用例2: 用例编码冲突 - overwrite策略
- 上传包含已存在用例编码的数据，使用overwrite策略
- 预期结果: 现有用例被覆盖（需要实现覆盖逻辑）

#### 测试用例3: 用例编码冲突 - rename策略
- 上传包含已存在用例编码的数据，使用rename策略
- 预期结果: 用例编码被重命名（需要实现重命名逻辑）

## 测试数据示例

### Excel文件测试数据
创建包含以下列的Excel文件：

| case_code | name | description | priority | severity | tags | expected_http_status |
|-----------|------|-------------|----------|----------|------|---------------------|
| TC-API-101-001 | 用户登录-成功场景 | 测试成功登录场景 | P0 | high | 冒烟测试,登录功能 | 200 |
| TC-API-101-002 | 用户登录-密码错误 | 测试密码错误场景 | P1 | medium | 登录功能,异常测试 | 401 |
| TC-API-101-003 | 用户登录-用户不存在 | 测试用户不存在场景 | P1 | medium | 登录功能,异常测试 | 404 |

### CSV文件测试数据
创建包含以下内容的CSV文件：

```csv
case_code,name,description,priority,severity,tags,expected_http_status
TC-API-101-001,用户登录-成功场景,测试成功登录场景,P0,high,"冒烟测试,登录功能",200
TC-API-101-002,用户登录-密码错误,测试密码错误场景,P1,medium,"登录功能,异常测试",401
TC-API-101-003,用户登录-用户不存在,测试用户不存在场景,P1,medium,"登录功能,异常测试",404
```

## 测试工具推荐

1. **Postman**: 用于API测试
2. **curl**: 命令行测试工具
3. **Excel/CSV编辑器**: 准备测试数据文件

## 测试检查点

1. **功能正确性**: 导入的数据是否正确保存到数据库
2. **错误处理**: 各种异常情况是否正确处理
3. **性能**: 大量数据导入时的性能表现
4. **事务一致性**: 部分失败时数据回滚是否正确
5. **日志记录**: 导入过程是否有详细的日志记录

## 注意事项

1. 测试前确保数据库中有足够的测试数据
2. 测试过程中注意观察应用日志
3. 测试完成后清理测试数据
4. 建议使用不同的用户权限进行测试
5. 测试文件大小限制时注意文件大小
