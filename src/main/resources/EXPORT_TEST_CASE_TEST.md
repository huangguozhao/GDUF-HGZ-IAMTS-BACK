# 测试用例导出功能测试说明

## 测试环境准备

1. **启动应用**: 确保Spring Boot应用正常运行
2. **数据库准备**: 确保数据库中有测试用的接口和用例数据
3. **用户登录**: 获取有效的JWT Token

## 测试用例

### 1. 正常导出测试

#### 测试步骤
1. 使用Postman或其他工具发送GET请求到 `/apis/{api_id}/test-cases/export`
2. 设置请求头: `Authorization: Bearer {token}`
3. 发送请求

#### 预期结果
- HTTP状态码: 200
- 响应头包含正确的Content-Type和Content-Disposition
- 返回Excel文件流

### 2. 格式验证测试

#### 测试用例1: Excel格式导出
- 请求: `GET /apis/101/test-cases/export?format=excel`
- 预期结果: 返回.xlsx文件，Content-Type为Excel MIME类型

#### 测试用例2: CSV格式导出
- 请求: `GET /apis/101/test-cases/export?format=csv`
- 预期结果: 返回.csv文件，Content-Type为CSV MIME类型

#### 测试用例3: 不支持的格式
- 请求: `GET /apis/101/test-cases/export?format=txt`
- 预期结果: HTTP 400, code: -3, msg: "不支持的导出格式"

### 3. 权限验证测试

#### 测试用例1: 未提供Token
- 不设置Authorization头
- 预期结果: HTTP 401, code: -1

#### 测试用例2: 无效Token
- 设置无效的Token
- 预期结果: HTTP 401, code: -1

#### 测试用例3: 权限不足
- 使用没有 `testcase:view` 权限的用户Token
- 预期结果: HTTP 403, code: -2

### 4. 接口验证测试

#### 测试用例1: 接口不存在
- 使用不存在的api_id
- 预期结果: HTTP 404, code: -4, msg: "接口不存在"

#### 测试用例2: 无用例数据
- 使用没有测试用例的接口ID
- 预期结果: HTTP 400, code: 0, msg: "该接口下没有可导出的测试用例"

### 5. 参数验证测试

#### 测试用例1: 包含已禁用用例
- 请求: `GET /apis/101/test-cases/export?include_disabled=true`
- 预期结果: 导出包含已禁用的用例

#### 测试用例2: 包含模板用例
- 请求: `GET /apis/101/test-cases/export?include_templates=true`
- 预期结果: 导出包含模板用例

#### 测试用例3: 指定导出字段
- 请求: `GET /apis/101/test-cases/export?fields=case_code,name,priority`
- 预期结果: 只导出指定的字段

#### 测试用例4: 无效字段过滤
- 请求: `GET /apis/101/test-cases/export?fields=invalid_field,case_code`
- 预期结果: 忽略无效字段，只导出有效字段

#### 测试用例5: 自定义文件名
- 请求: `GET /apis/101/test-cases/export?filename=my_testcases`
- 预期结果: 文件名包含自定义前缀和时间戳

### 6. 文件内容验证测试

#### 测试用例1: Excel文件结构
- 验证Excel文件包含3个工作表：测试用例、数据字典、导入模板
- 验证表头正确
- 验证数据内容正确

#### 测试用例2: CSV文件结构
- 验证CSV文件包含正确的表头
- 验证数据行格式正确
- 验证UTF-8编码和BOM

#### 测试用例3: 数据完整性
- 验证导出的数据与数据库中的数据一致
- 验证JSON字段正确转换
- 验证时间格式正确

### 7. 性能测试

#### 测试用例1: 大量数据导出
- 准备包含大量测试用例的接口
- 测试导出性能
- 验证内存使用情况

#### 测试用例2: 并发导出
- 多个用户同时导出不同接口的用例
- 验证系统稳定性

## 测试数据准备

### 测试接口数据
确保数据库中有以下测试数据：
- 接口ID: 101, 状态: active
- 接口ID: 102, 状态: inactive
- 接口ID: 999, 不存在

### 测试用例数据
为接口101准备以下测试用例：
- 正常启用的用例
- 已禁用的用例
- 模板用例
- 包含各种字段值的用例

## 测试工具推荐

1. **Postman**: 用于API测试
2. **curl**: 命令行测试工具
3. **Excel/CSV查看器**: 验证导出文件内容
4. **文本编辑器**: 查看CSV文件编码

## 测试检查点

1. **功能正确性**: 导出的文件内容是否正确
2. **格式正确性**: 文件格式是否符合规范
3. **错误处理**: 各种异常情况是否正确处理
4. **性能表现**: 大量数据导出时的性能
5. **权限控制**: 权限验证是否正确
6. **文件下载**: 浏览器是否能正确下载文件
7. **编码处理**: 中文字符是否正确显示

## 常见问题排查

### 1. 文件下载失败
- 检查Content-Type设置
- 检查Content-Disposition设置
- 检查文件大小

### 2. 中文乱码
- 检查CSV文件的UTF-8编码
- 检查BOM设置
- 检查Excel文件的字符编码

### 3. 权限错误
- 检查JWT Token是否有效
- 检查用户权限配置
- 检查接口权限设置

### 4. 数据不完整
- 检查数据库查询条件
- 检查字段映射
- 检查JSON字段转换

## 注意事项

1. 测试前确保数据库中有足够的测试数据
2. 测试过程中注意观察应用日志
3. 测试完成后清理测试数据
4. 建议使用不同的用户权限进行测试
5. 测试文件下载时注意浏览器设置
6. 验证导出文件可以用作导入模板
