# 执行密码重置接口文档

## 接口概述

**接口名称**: 执行密码重置  
**接口路径**: `/auth/password/reset`  
**请求方式**: `POST`  
**接口描述**: 用户通过收到的验证码、账号信息以及新密码来最终完成密码重置

## 请求参数

### 请求头
```
Content-Type: application/json
```

### 请求体参数

| 参数名              | 类型   | 是否必须 | 备注                         |
| :------------------ | :----- | :------- | :--------------------------- |
| `account`           | string | 必须     | 请求重置时使用的邮箱或手机号 |
| `verification_code` | string | 必须     | 从邮箱或短信中收到的验证码   |
| `new_password`      | string | 必须     | 新的密码                     |

### 请求示例

**通过邮箱重置**:
```json
{
  "account": "user@example.com",
  "verification_code": "889977",
  "new_password": "MyNewSecurePassword123!"
}
```

**通过手机号重置**:
```json
{
  "account": "13800138000",
  "verification_code": "445566",
  "new_password": "AnotherSecurePwd456@"
}
```

## 响应数据

### 成功响应

**HTTP状态码**: `200`

```json
{
  "code": 1,
  "msg": "密码重置成功",
  "data": null
}
```

### 失败响应

#### 验证码错误
```json
{
  "code": 0,
  "msg": "验证码错误或已失效",
  "data": null
}
```

#### 账号不存在
```json
{
  "code": -4,
  "msg": "该邮箱/手机号未注册",
  "data": null
}
```

#### 密码强度不符合要求
```json
{
  "code": -3,
  "msg": "密码必须包含大小写字母、数字和特殊字符，且长度至少为8位",
  "data": null
}
```

#### 账户未激活
```json
{
  "code": 0,
  "msg": "账户未激活，无法重置密码",
  "data": null
}
```

## 业务逻辑

1. **用户验证**: 根据`account`查找用户是否存在
2. **状态检查**: 验证用户状态是否为"active"
3. **密码强度**: 验证新密码是否符合安全策略
4. **验证码校验**: 验证验证码是否正确且未过期
5. **密码加密**: 使用BCrypt对新密码进行加密
6. **数据库更新**: 更新用户表中的密码字段
7. **验证码失效**: 删除Redis中的验证码，防止重放攻击

## 密码安全策略

密码必须满足以下要求：
- **长度**: 至少8位字符
- **小写字母**: 至少包含一个a-z字符
- **大写字母**: 至少包含一个A-Z字符
- **数字**: 至少包含一个0-9字符
- **特殊字符**: 至少包含一个@$!%*?&字符

## 错误码说明

| 错误码 | 含义 | HTTP状态码 | 处理建议 |
|--------|------|------------|----------|
| 1 | 成功 | 200 | - |
| 0 | 业务逻辑失败 | 200 | 展示msg给用户 |
| -3 | 参数校验失败 | 400 | 提示用户检查输入 |
| -4 | 资源不存在 | 404 | 提示用户"请求的资源不存在" |
| -5 | 服务器内部异常 | 500 | 提示用户"系统繁忙，请稍后再试" |

## 安全特性

1. **验证码时效性**: 验证码有效期为15分钟
2. **一次性使用**: 验证码使用后立即失效
3. **密码加密**: 使用BCrypt进行密码加密存储
4. **防重放攻击**: 验证码使用后删除，防止重复使用
5. **用户状态验证**: 只有激活状态的用户才能重置密码

## 前置条件

1. 用户必须先调用`/auth/password/reset-request`接口获取验证码
2. 用户必须通过邮箱或短信收到验证码
3. 验证码必须在有效期内使用

## 注意事项

1. 验证码区分大小写
2. 密码重置成功后，用户需要使用新密码登录
3. 建议用户重置密码后立即登录验证
4. 系统会记录密码更新时间到`updated_at`字段

## 相关接口

- [密码重置请求接口](./PASSWORD_RESET_TEST.md)
- [用户登录接口](./README_AUTH.md)
