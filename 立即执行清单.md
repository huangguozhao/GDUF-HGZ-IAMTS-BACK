# âš¡ ç«‹å³æ‰§è¡Œæ¸…å• - è§£å†³ç³»ç»Ÿå¼‚å¸¸é—®é¢˜

## ğŸ¯ ä½ ç°åœ¨é‡åˆ°çš„é—®é¢˜

æ‰€æœ‰æ¥å£è¿”å›ï¼š`{"code":-5,"msg":"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•"}`

## âœ… ç«‹å³æ‰§è¡Œï¼ˆ5åˆ†é’Ÿè§£å†³ï¼‰

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆ2åˆ†é’Ÿï¼‰

**æ‰“å¼€MySQLå®¢æˆ·ç«¯**ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```sql
-- 1. è¿æ¥å¹¶åˆ‡æ¢æ•°æ®åº“
USE iatmsdb_dev;

-- 2. æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SHOW TABLES LIKE 'TestCaseResults';

-- 3. å¦‚æœè¿”å› "Empty set"ï¼Œè¯´æ˜è¡¨ä¸å­˜åœ¨ï¼Œæ‰§è¡Œä¸‹é¢çš„å»ºè¡¨è¯­å¥ï¼š
```

**å¤åˆ¶ä¸‹é¢çš„å®Œæ•´SQLï¼Œç²˜è´´æ‰§è¡Œï¼š**

```sql
CREATE TABLE IF NOT EXISTS TestCaseResults (
    result_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    report_id BIGINT NULL,
    execution_id BIGINT NULL,
    task_type ENUM('test_suite', 'test_case', 'project', 'module', 'api_monitor') NOT NULL DEFAULT 'test_suite',
    ref_id INT NOT NULL,
    full_name VARCHAR(500),
    status ENUM('passed', 'failed', 'broken', 'skipped', 'unknown') NOT NULL,
    duration BIGINT,
    start_time DATETIME NULL,
    end_time DATETIME NULL,
    failure_message TEXT,
    failure_trace TEXT,
    failure_type VARCHAR(100),
    error_code VARCHAR(50),
    steps_json JSON,
    parameters_json JSON,
    attachments_json JSON,
    logs_link VARCHAR(500),
    screenshot_link VARCHAR(500),
    video_link VARCHAR(500),
    environment VARCHAR(50),
    browser VARCHAR(50),
    os VARCHAR(50),
    device VARCHAR(50),
    tags_json JSON,
    severity ENUM('blocker', 'critical', 'normal', 'minor', 'trivial'),
    priority ENUM('P0', 'P1', 'P2', 'P3'),
    retry_count INT DEFAULT 0,
    flaky BOOLEAN DEFAULT false,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_deleted BOOLEAN DEFAULT FALSE,
    deleted_at TIMESTAMP NULL,
    deleted_by INT NULL,
    INDEX idx_status (status),
    INDEX idx_environment (environment),
    INDEX idx_is_deleted(is_deleted)
);

-- æ’å…¥10æ¡æµ‹è¯•æ•°æ®
INSERT INTO TestCaseResults (report_id, execution_id, task_type, ref_id, full_name, status, duration, start_time, end_time, environment, browser, os, device, severity, priority) VALUES 
(1001, 30001, 'test_case', 101, 'ç”¨æˆ·ç™»å½•-æˆåŠŸ', 'passed', 1245, '2024-09-16 10:30:00', '2024-09-16 10:30:01', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'critical', 'P0'),
(1001, 30002, 'test_case', 102, 'ç”¨æˆ·æ³¨å†Œ-å¤±è´¥', 'failed', 856, '2024-09-16 10:30:02', '2024-09-16 10:30:03', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'normal', 'P1'),
(1001, 30003, 'test_case', 103, 'å•†å“æŸ¥è¯¢-å¼‚å¸¸', 'broken', 2340, '2024-09-16 10:31:00', '2024-09-16 10:31:02', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'critical', 'P0'),
(1001, 30004, 'test_case', 104, 'è®¢å•åˆ›å»º-è·³è¿‡', 'skipped', 0, '2024-09-16 10:32:00', '2024-09-16 10:32:00', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'normal', 'P2'),
(1002, 30005, 'module', 1, 'ç”¨æˆ·ç®¡ç†æ¨¡å—', 'passed', 3560, '2024-09-16 10:33:00', '2024-09-16 10:33:04', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'normal', 'P1'),
(1003, 30006, 'project', 1, 'ç”µå•†å¹³å°é¡¹ç›®', 'failed', 15678, '2024-09-16 10:35:00', '2024-09-16 10:35:16', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'critical', 'P0'),
(1004, 30007, 'api_monitor', 201, 'APIå¥åº·æ£€æŸ¥', 'passed', 234, '2024-09-16 10:40:00', '2024-09-16 10:40:00', 'production', 'Monitor', 'Linux', 'Server', 'normal', 'P2'),
(1005, 30008, 'test_suite', 301, 'å›å½’æµ‹è¯•å¥—ä»¶', 'failed', 8920, '2024-09-16 10:45:00', '2024-09-16 10:45:09', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'high', 'P1'),
(1001, 30009, 'test_case', 105, 'æ—¶é—´æ ¼å¼åŒ–', 'passed', 45, '2024-09-16 10:50:00', '2024-09-16 10:50:00', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'low', 'P3'),
(1001, 30010, 'test_case', 106, 'æ•°æ®å¯¼å‡º', 'passed', 25678, '2024-09-16 11:00:00', '2024-09-16 11:00:26', 'test', 'Chrome 115', 'Windows 10', 'Desktop', 'normal', 'P2');

-- éªŒè¯
SELECT COUNT(*) FROM TestCaseResults;
```

**æ‰§è¡Œå®Œæˆååº”è¯¥çœ‹åˆ°ï¼š**
```
+----------+
| COUNT(*) |
+----------+
|       10 |
+----------+
```

---

### æ­¥éª¤2ï¼šé‡å¯åº”ç”¨ï¼ˆ1åˆ†é’Ÿï¼‰

åœ¨è¿è¡Œåº”ç”¨çš„å‘½ä»¤è¡Œçª—å£ï¼š

```bash
# æŒ‰ Ctrl+C åœæ­¢åº”ç”¨

# é‡æ–°å¯åŠ¨
mvn spring-boot:run

# ç­‰å¾…çœ‹åˆ°è¿™è¡Œï¼ˆè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼‰ï¼š
# Started IatmsApplication in xxx seconds (JVM running for xxx)
```

---

### æ­¥éª¤3ï¼šæµ‹è¯•æ¥å£ï¼ˆ30ç§’ï¼‰

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
simple_test.bat
```

**é¢„æœŸç»“æœï¼š**
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 10,
    "items": [...]
  }
}
```

å¦‚æœçœ‹åˆ° `"code":1`ï¼Œè¯´æ˜æˆåŠŸäº†ï¼ ğŸ‰

---

## ğŸŠ æˆåŠŸåçš„æµ‹è¯•

### æµ‹è¯•æ‰€æœ‰æŸ¥è¯¢åŠŸèƒ½

```bash
# 1. åŸºæœ¬æŸ¥è¯¢
curl http://localhost:8080/api/test-results

# 2. æŸ¥è¯¢å¤±è´¥çš„ç”¨ä¾‹
curl "http://localhost:8080/api/test-results?status=failed"

# 3. æŸ¥è¯¢é«˜ä¼˜å…ˆçº§ç”¨ä¾‹
curl "http://localhost:8080/api/test-results?priority=P0,P1"

# 4. æŸ¥è¯¢æµ‹è¯•ç”¨ä¾‹ç±»å‹
curl "http://localhost:8080/api/test-results?task_type=test_case"

# 5. æŒ‰æ‰§è¡Œæ—¶é•¿é™åº
curl "http://localhost:8080/api/test-results?sort_by=duration&sort_order=desc"

# 6. è·å–è¯¦æƒ…
curl http://localhost:8080/api/test-results/1

# 7. è·å–è¯¦æƒ…ï¼ˆåŒ…å«é™„ä»¶ï¼‰
curl "http://localhost:8080/api/test-results/1?include_artifacts=true"
```

---

## ğŸ“Š é¢„æœŸçš„æµ‹è¯•ç»“æœ

æ‰§è¡ŒSQLåï¼Œä½ åº”è¯¥æœ‰ï¼š
- âœ… 10æ¡æµ‹è¯•ç»“æœè®°å½•
- âœ… 6æ¡é€šè¿‡ (passed)
- âœ… 3æ¡å¤±è´¥ (failed)
- âœ… 1æ¡ä¸­æ–­ (broken)
- âœ… 1æ¡è·³è¿‡ (skipped)
- âœ… æˆåŠŸç‡ï¼š60%

---

## ğŸ” éªŒè¯æ˜¯å¦æˆåŠŸ

### æ–¹æ³•1ï¼šæŸ¥çœ‹è¿”å›çš„code
```bash
curl http://localhost:8080/api/test-results
```
- âœ… æˆåŠŸï¼š`"code":1`
- âŒ å¤±è´¥ï¼š`"code":-5`

### æ–¹æ³•2ï¼šæŸ¥çœ‹è¿”å›çš„æ•°æ®
æˆåŠŸçš„å“åº”åº”è¯¥åŒ…å«ï¼š
- `"total": 10`
- `"items": [...]` (10æ¡è®°å½•)
- `"summary": {...}` (ç»Ÿè®¡ä¿¡æ¯)

---

## â° æ—¶é—´é¢„ä¼°

- åˆ›å»ºè¡¨ï¼š**2åˆ†é’Ÿ**
- é‡å¯åº”ç”¨ï¼š**1åˆ†é’Ÿ**
- æµ‹è¯•éªŒè¯ï¼š**1åˆ†é’Ÿ**

**æ€»è®¡ï¼šçº¦4åˆ†é’Ÿ** âš¡

---

## ğŸ“ å¦‚æœè¿˜æ˜¯å¤±è´¥

æŠŠåº”ç”¨æ§åˆ¶å°çš„ERRORæ—¥å¿—å‘ç»™æˆ‘ï¼Œä¾‹å¦‚ï¼š

```
ERROR xxx.xxx.xxx - xxxxx
java.lang.XxxException: ...
    at com.victor.iatms.xxx
    ...
```

æˆ‘ä¼šç«‹å³å¸®ä½ è§£å†³ï¼

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“ä½ çœ‹åˆ°è¿™æ ·çš„å“åº”æ—¶ï¼Œè¯´æ˜ä¸€åˆ‡éƒ½æ­£å¸¸äº†ï¼š

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 10,
    "items": [
      {
        "result_id": 1,
        "status": "passed",
        "full_name": "ç”¨æˆ·ç™»å½•-æˆåŠŸ",
        ...
      }
    ],
    "page": 1,
    "page_size": 20,
    "summary": {
      "total_count": 10,
      "passed": 6,
      "failed": 3,
      "broken": 1,
      "skipped": 1,
      "success_rate": 60.00
    }
  }
}
```

**æ­å–œï¼æ¥å£æ­£å¸¸å·¥ä½œäº†ï¼** ğŸŠ

---

**ç°åœ¨å°±å»æ‰§è¡Œå§ï¼** ğŸš€

